# Основы PyTorch

## Цель задания

Закрепить навыки работы с тензорами PyTorch, изучить основные операции и научиться решать практические задачи.

## Навигация

- [Задание 1: Создание и манипуляции с тензорами](#задание-1-создание-и-манипуляции-с-тензорами)
- [Задание 2: Автоматическое дифференцирование](#задание-2-автоматическое-дифференцирование)
- [Задание 3: Сравнение производительности CPU vs CUDA](#задание-3-сравнение-производительности-cpu-vs-cuda)

## Задание 1: Создание и манипуляции с тензорами

Создал файл [`homework_tensors.py`](./homework_tensors.py) и выполнил задачи:

### 1.1 Создание тензоров

Создайте следующие тензоры:

- Тензор размером 3x4, заполненный случайными числами от 0 до 1
- Тензор размером 2x3x4, заполненный нулями
- Тензор размером 5x5, заполненный единицами
- Тензор размером 4x4 с числами от 0 до 15 (используя reshape)

#### Вывод программы

```
Задание 1:
-----------------------------------------------------

Тензор 3x4, заполненный случайными числами:
tensor([[0.6309, 0.8436, 0.5720, 0.6564],
        [0.4611, 0.1527, 0.6406, 0.3883],
        [0.2143, 0.0952, 0.8842, 0.2242]])

Тензор 2x3x4, заполненный нулями:
tensor([[[0., 0., 0., 0.],
         [0., 0., 0., 0.],
         [0., 0., 0., 0.]],

        [[0., 0., 0., 0.],
         [0., 0., 0., 0.],
         [0., 0., 0., 0.]]])

Тензор 5x5, заполненный единицами:
tensor([[1., 1., 1., 1., 1.],
        [1., 1., 1., 1., 1.],
        [1., 1., 1., 1., 1.],
        [1., 1., 1., 1., 1.],
        [1., 1., 1., 1., 1.]])

Тензор 4x4 с числами от 0 до 15:
tensor([[ 0,  1,  2,  3],
        [ 4,  5,  6,  7],
        [ 8,  9, 10, 11],
        [12, 13, 14, 15]])
```

### 1.2 Операции с тензорами

Дано: тензор A размером 3x4 и тензор B размером 4x3  
Выполните:

- Транспонирование тензора A
- Матричное умножение A и B
- Поэлементное умножение A и транспонированного B
- Вычислите сумму всех элементов тензора A

#### Вывод программы

```
Задание 2:
-----------------------------------------------------

Тензор A:
tensor([[0.1545, 0.8336, 0.1728, 0.0448],
        [0.0147, 0.0381, 0.6285, 0.0075],
        [0.0154, 0.2041, 0.0126, 0.9008]])

Тензор B:
tensor([[0.8677, 0.8962, 0.4090],
        [0.8956, 0.9537, 0.3864],
        [0.7741, 0.8697, 0.3117],
        [0.7907, 0.5081, 0.8425]])

Транспонированный A:
tensor([[0.1545, 0.0147, 0.0154],
        [0.8336, 0.0381, 0.2041],
        [0.1728, 0.6285, 0.0126],
        [0.0448, 0.0075, 0.9008]])

Матричное умножение A на B:
tensor([[1.0499, 1.1066, 0.4770],
        [0.5394, 0.6000, 0.2230],
        [0.9181, 0.6771, 0.8479]])

Поэлементное умножение A на A транспонированное:
tensor([[0.1341, 0.7466, 0.1338, 0.0354],
        [0.0132, 0.0363, 0.5466, 0.0038],
        [0.0063, 0.0789, 0.0039, 0.7588]])

Сумма всех элементов A:
tensor(3.0275)
```

### 1.3 Индексация и срезы

Создайте тензор размером 5x5x5  
Извлеките:

- Первую строку
- Последний столбец
- Подматрицу размером 2x2 из центра тензора
- Все элементы с четными индексами

#### Вывод программы

```
Задание 3:
------------------------------------------------------

Тензор:
tensor([[[0.3344, 0.1405, 0.6164, 0.5492, 0.1530],
         [0.4854, 0.6057, 0.0878, 0.1374, 0.0888],
         [0.1883, 0.7274, 0.7418, 0.5369, 0.6465],
         [0.5735, 0.8472, 0.3894, 0.8673, 0.8040],
         [0.6070, 0.4371, 0.7982, 0.8173, 0.8702]],

        [[0.4190, 0.0209, 0.3718, 0.8172, 0.5062],
         [0.8032, 0.0936, 0.1758, 0.6877, 0.6131],
         [0.0903, 0.7721, 0.4961, 0.3693, 0.3191],
         [0.1408, 0.4555, 0.3754, 0.7762, 0.6127],
         [0.7378, 0.5425, 0.9488, 0.1491, 0.5544]],

        [[0.3920, 0.4804, 0.5910, 0.9723, 0.1900],
         [0.9068, 0.6673, 0.8965, 0.5934, 0.9216],
         [0.4444, 0.8144, 0.9244, 0.8897, 0.2323],
         [0.6946, 0.1900, 0.6277, 0.4591, 0.3118],
         [0.1378, 0.9040, 0.2501, 0.1023, 0.0686]],

        [[0.5265, 0.8211, 0.2343, 0.1779, 0.3843],
         [0.6396, 0.3766, 0.4591, 0.3075, 0.1045],
         [0.6685, 0.2118, 0.2179, 0.7083, 0.6146],
         [0.0072, 0.7054, 0.4163, 0.0074, 0.5287],
         [0.1547, 0.5975, 0.2495, 0.4077, 0.3586]],

        [[0.4370, 0.9024, 0.3323, 0.9474, 0.9441],
         [0.4395, 0.7449, 0.9853, 0.7899, 0.6873],
         [0.6010, 0.4309, 0.2404, 0.7748, 0.4859],
         [0.9167, 0.6888, 0.9625, 0.3459, 0.0942],
         [0.8734, 0.3907, 0.9271, 0.8099, 0.7060]]])

Первая строка:
tensor([[0.3344, 0.1405, 0.6164, 0.5492, 0.1530],
        [0.4854, 0.6057, 0.0878, 0.1374, 0.0888],
        [0.1883, 0.7274, 0.7418, 0.5369, 0.6465],
        [0.5735, 0.8472, 0.3894, 0.8673, 0.8040],
        [0.6070, 0.4371, 0.7982, 0.8173, 0.8702]])

Последний столбец:
tensor([[0.1530, 0.0888, 0.6465, 0.8040, 0.8702],
        [0.5062, 0.6131, 0.3191, 0.6127, 0.5544],
        [0.1900, 0.9216, 0.2323, 0.3118, 0.0686],
        [0.3843, 0.1045, 0.6146, 0.5287, 0.3586],
        [0.9441, 0.6873, 0.4859, 0.0942, 0.7060]])

Подматрица 2x2 из центра тензора:
tensor([[0.6673, 0.8965],
        [0.8144, 0.9244]])

Элементы с четными индексами:
tensor([[[0.3344, 0.6164, 0.1530],
         [0.1883, 0.7418, 0.6465],
         [0.6070, 0.7982, 0.8702]],

        [[0.3920, 0.5910, 0.1900],
         [0.4444, 0.9244, 0.2323],
         [0.1378, 0.2501, 0.0686]],

        [[0.4370, 0.3323, 0.9441],
         [0.6010, 0.2404, 0.4859],
         [0.8734, 0.9271, 0.7060]]])
```

### 1.4 Работа с формами

Создайте тензор размером 24 элемента  
Преобразуйте его в формы:

- 2x12
- 3x8
- 4x6
- 2x3x4
- 2x2x2x3

#### Вывод программы

```
Задание 4:
---------------------------------------------------------

Тензор:
tensor([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23])

Преобразование в форму 2x12:
tensor([[ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11],
        [12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]])

Форма 3x8:
tensor([[ 0,  1,  2,  3,  4,  5,  6,  7],
        [ 8,  9, 10, 11, 12, 13, 14, 15],
        [16, 17, 18, 19, 20, 21, 22, 23]])

Форма 4x6:
tensor([[ 0,  1,  2,  3,  4,  5],
        [ 6,  7,  8,  9, 10, 11],
        [12, 13, 14, 15, 16, 17],
        [18, 19, 20, 21, 22, 23]])

Форма 2x3x4:
tensor([[[ 0,  1,  2,  3],
         [ 4,  5,  6,  7],
         [ 8,  9, 10, 11]],

        [[12, 13, 14, 15],
         [16, 17, 18, 19],
         [20, 21, 22, 23]]])

Форма 2x2x2x3:
tensor([[[[ 0,  1,  2],
          [ 3,  4,  5]],

         [[ 6,  7,  8],
          [ 9, 10, 11]]],


        [[[12, 13, 14],
          [15, 16, 17]],

         [[18, 19, 20],
          [21, 22, 23]]]])
```

## Задание 2: Автоматическое дифференцирование

Создал файл [`homework_autograd.py`](./homework_autograd.py).

### 2.1 Простые вычисления с градиентами

- Создайте тензоры x, y, z с `requires_grad=True`
- Вычислите функцию: `f(x,y,z) = x^2 + y^2 + z^2 + 2*x*y*z`
- Найдите градиенты по всем переменным
- Проверьте результат аналитически

#### Вывод программы

```
Задание 1:
-------------------------------------------
Градиент по x: 28.0
Градиент по y: 22.0
Градиент по z: 20.0
```

#### Проверка

Подставляем: `x = 2`, `y = 3`, `z = 4`  
В производные

- x: `2x + 2yz = 4 + 24 = 28`
- y: `2y + 2xz = 6 + 16 = 22`
- z: `2z + 2xy = 8 + 12 = 20`

### 2.2 Градиент функции потерь

- Реализуйте функцию MSE (Mean Squared Error):
- MSE = (1/n) * Σ(y_pred - y_true)^2
- где y_pred = w * x + b (линейная функция)
- Найдите градиенты по w и b

#### Вывод программы

```
Задание 2:
--------------------------------------------------
Градиент по w: -9.333333969116211
Градиент по b: -4.0
```

### 2.3 Цепное правило

- Реализуйте составную функцию: f(x) = sin(x^2 + 1)
- Найдите градиент df/dx
- Проверьте результат с помощью torch.autograd.grad

#### Вывод программы

```
Задание 3:
--------------------------------------------------
Градиент f(x) = sin(x^2 + 1):  -2.982388973236084
Проверка через autograd.grad:  -2.982388973236084
```

## Задание 3: Сравнение производительности CPU vs CUDA

Код программы в файле [`homework_performance.py`](./homework_performance.py), но измерения проводил в *Google Colab*

### 3.1 Подготовка данных

Создайте большие матрицы размеров:

- 64 x 1024 x 1024
- 128 x 512 x 512
- 256 x 256 x 256

Заполните их случайными числами.

### 3.2 Функция измерения времени

Создайте функцию для измерения времени выполнения операций  
Используйте `torch.cuda.Event()` для точного измерения на GPU  
Используйте `time.time()` для измерения на CPU  

### 3.3 Сравнение операций

Сравните время выполнения следующих операций на CPU и CUDA:

- Матричное умножение (torch.matmul)
- Поэлементное сложение
- Поэлементное умножение
- Транспонирование
- Вычисление суммы всех элементов

Для каждой операции:

1. Измерьте время на CPU
2. Измерьте время на GPU (если доступен)
3. Вычислите ускорение (speedup)
4. Выведите результаты в табличном виде

### 3.4 Анализ результатов

| Операция               | Размер                       | CPU (мс) | GPU (мс)  | Ускорение |
| ---------------------- | ---------------------------- | -------- | --------- | --------- |
| Матричное умножение    | torch.Size([64, 1024, 1024]) | 1.263044 | 34.234502 | 0.04x     |
| Поэлементное сложение  | torch.Size([64, 1024, 1024]) | 0.162271 | 3.339907  | 0.05x     |
| Поэлементное умножение | torch.Size([64, 1024, 1024]) | 0.165405 | 3.230477  | 0.05x     |
| Транспонирование       | torch.Size([64, 1024, 1024]) | 0.000027 | 0.018093  | 0.00x     |
| Сумма всех элементов   | torch.Size([64, 1024, 1024]) | 0.021511 | 1.015533  | 0.02x     |
| Матричное умножение    | torch.Size([128, 512, 512])  | 0.353274 | 12.122672 | 0.03x     |
| Поэлементное сложение  | torch.Size([128, 512, 512])  | 0.070261 | 1.622016  | 0.04x     |
| Поэлементное умножение | torch.Size([128, 512, 512])  | 0.070134 | 1.614710  | 0.04x     |
| Транспонирование       | torch.Size([128, 512, 512])  | 0.000030 | 0.017030  | 0.00x     |
| Сумма всех элементов   | torch.Size([128, 512, 512])  | 0.009931 | 0.542467  | 0.02x     |
| Матричное умножение    | torch.Size([256, 256, 256])  | 0.114572 | 3.189149  | 0.04x     |
| Поэлементное сложение  | torch.Size([256, 256, 256])  | 0.034502 | 0.817523  | 0.04x     |
| Поэлементное умножение | torch.Size([256, 256, 256])  | 0.033151 | 0.820275  | 0.04x     |
| Транспонирование       | torch.Size([256, 256, 256])  | 0.000030 | 0.014259  | 0.00x     |
| Сумма всех элементов   | torch.Size([256, 256, 256])  | 0.004768 | 0.282323  | 0.02x     |

---

**Не получилось добиться ускорения на GPU**